(function(t){if(!t)throw"Error jsCalendar library was not found";var e=function(){0!==arguments.length&&this._construct(arguments)};e.version="v1.1.1",e.options={format:"DD/MM/YYYY",autoValueRead:!1,yearsLine:!1,offsetTop:2,offsetLeft:-4,close_keycodes:[9,27,13],class:"jsCalendar-datepicker-wrappper"},e.prototype._construct=function(e){e=this._parseArguments(e),this._setTarget(e.target);var s=this._parseOptions(e.options);this._visible=!1,this._wrapper=document.createElement("div"),this._wrapper.className=this._options.class,this._wrapper.style.display="none",this._wrapper.style.position="absolute",document.body.appendChild(this._wrapper),s.target=this._wrapper,this.jsCalendar=new t(s),this._options.yearsLine&&this._creatYearsLine();var i=this;if(this.jsCalendar.onDateClick(function(t,e){i._onPick(e)}),this._target.addEventListener("focus",function(){i._onFocus()},!1),this._target.addEventListener("keydown",function(t){i._options.close_keycodes.indexOf(t.keyCode)>=0&&i.hide()},!1),this._options.autoValueRead&&(this._target.addEventListener("keyup",function(){i.readInput()},!1),this._target.addEventListener("change",function(){i.readInput()},!1)),this.jsCalendar._elements.table.addEventListener("click",function(t){t.stopPropagation()},!1),window.addEventListener("click",function(t){t.target!==i._target&&i.hide()},!1),window.addEventListener("resize",function(){i._visible&&i.position()},!1),window.addEventListener("scroll",function(){i._visible&&i.position()},!1),s.hasOwnProperty("date"))this.set(s.date);else{var o=new Date(i.jsCalendar._date.getTime());this.set(o)}},e.prototype._parseArguments=function(t){var e={target:null,options:{}};if(0===t.length)throw new Error("jsCalendar-datepicker: No parameters were given.");if(1===t.length)if(("object"==typeof HTMLElement?t[0]instanceof HTMLElement:t[0])&&"object"==typeof t[0]&&null!==t[0]&&1===t[0].nodeType&&"string"==typeof t[0].nodeName||"string"==typeof t[0])e.target=t[0];else{if(e.options=t[0],void 0===t[0].target)throw new Error("jsCalendar-datepicker: Not target was given.");e.target=t[0].target}else e.target=t[0],t.length>=3&&(e.options=t[2]),t.length>=2&&(e.options.date=t[1]);return e},e.prototype._setTarget=function(e){var s=t.tools.getElement(e);if(!s)throw new Error("jsCalendar-datepicker: Target was not found.");this._target=s},e.prototype._parseOptions=function(s){this._options={};var i,o={};for(i in e.options)e.options.hasOwnProperty(i)&&(e.options[i]instanceof Array?this._options[i]=e.options[i].slice(0):this._options[i]=e.options[i]),s.hasOwnProperty(i)?o[i]=s[i]:this._target.dataset.hasOwnProperty(i)&&(o[i]=this._target.dataset[i]);for(i in void 0!==o.format&&(this._options.format=o.format),void 0!==o.offsetTop&&("number"==typeof o.offsetTop?this._options.offsetTop=o.offsetTop:"string"==typeof o.offsetTop&&(i=parseInt(o.offsetTop,10),isNaN(i)||(this._options.offsetTop=i))),void 0!==o.offsetLeft&&("number"==typeof o.offsetLeft?this._options.offsetLeft=o.offsetLeft:"string"==typeof o.offsetLeft&&(i=parseInt(o.offsetLeft,10),isNaN(i)||(this._options.offsetLeft=i))),"string"==typeof o.class&&(this._options.class=o.class),void 0!==o.yearsLine&&o.yearsLine&&(i=parseInt(o.yearsLine,10),isNaN(i)?this._options.yearsLine=!0:i>0&&(this._options.yearsLine=i)),o={},t.options)s.hasOwnProperty(i)?o[i]=s[i]:this._target.dataset.hasOwnProperty(i)&&(o[i]=this._target.dataset[i]);return s.hasOwnProperty("date")?o.date=s.date:o.hasOwnProperty("date")||(this._target.value.length>0&&null!==t.tools.parseDate(this._target.value,!0)?o.date=this._target.value:this._target.dataset.hasOwnProperty("date")&&(o.date=this._target.dataset.date)),this._options.autoValueRead="DD/MM/YYYY"===this._options.format||"DD-MM-YYYY"===this._options.format,o},e.prototype._onFocus=function(){this.jsCalendar.reset(),this.show()},e.prototype._onPick=function(e){if(this.jsCalendar._options.min&&this.jsCalendar._options.min.getTime()>e)return;if(this.jsCalendar._options.max&&this.jsCalendar._options.max.getTime()<e)return;this._target.value=t.tools.dateToString(e,this._options.format,this.jsCalendar._options.language),this.jsCalendar.set(e);const s=new Event("change",{bubbles:!0});this._target.dispatchEvent(s),this.hide()},e.prototype.show=function(){this._visible||(this.position(),this._wrapper.style.display="block",this._visible=!0)},e.prototype.hide=function(){this._wrapper.style.display="none",this._visible=!1},e.prototype.isVisible=function(){return this._visible},e.prototype.position=function(){var t=this._wrapper.style.display;this._wrapper.style.top="-9999px",this._wrapper.style.left="-9999px",this._wrapper.style.display="block";var s=e.detectElementPositionInfo(this._target),i=s.left,o=s.top,a=this._target.clientHeight||this._target.offsetHeight||this._target.scrollHeight||20;o=o+a+this._options.offsetTop,i+=this._options.offsetLeft,document.body.offsetWidth<i+this._wrapper.offsetWidth&&(i=document.body.offsetWidth-this._wrapper.offsetWidth-1),this._wrapper.style.zIndex=s.zIndex?s.zIndex:1,this._wrapper.style.display=t,this._wrapper.style.top=o+"px",this._wrapper.style.left=i+"px"},e.prototype.readInput=function(){var e=t.tools.stringToDate(this._target.value,!0);return null!==e&&(this.jsCalendar.set(e),this._yearsLineUpdate(e)),e},e.prototype.set=function(e){e=t.tools.parseDate(e),this.jsCalendar.set(e),this._yearsLineUpdate(e),this._target.value=t.tools.dateToString(e,this._options.format,this.jsCalendar._options.language)},e.prototype._creatYearsLine=function(){if(!this._yearsLine){this._yearsLine={};var t=document.createElement("tr");t.className="jsCalendar-years-line";var e=document.createElement("th");e.setAttribute("colspan","7"),e.style.width="100%",t.appendChild(e);var s=document.createElement("table");s.style.margin="0 auto 0 auto",s.style.boxShadow="none",e.appendChild(s);var i=document.createElement("tbody");i.style.margin="0",s.appendChild(i);var o=document.createElement("tr");i.appendChild(o);for(var a,n=[],r=this,p=!0===this._options.yearsLine?5:this._options.yearsLine,d=0;d<p;d++)a=document.createElement("td"),a.style.display="table-cell",n.push(a),o.appendChild(a),a.addEventListener("click",function(){var t=new Date(r.jsCalendar._date.getTime());t.setFullYear(parseInt(this.dataset.year,10)),r.set(t)},!1);this._yearsLine.wrapper=t,this._yearsLine.table=s,this._yearsLine.years=n,this.jsCalendar._elements.head.insertBefore(t,this.jsCalendar._elements.head.childNodes[0]),this.jsCalendar.onMonthChange(function(){var t=new Date(r.jsCalendar._date.getTime());r._yearsLineUpdate(t)})}},e.prototype._yearsLineUpdate=function(t){if(this._yearsLine)for(var e=this._yearsLine.years.length,s=t.getFullYear(),i=0,o=s-(Math.ceil(e/2)-1);i<e;i++,o++)this._yearsLine.years[i].textContent=o,this._yearsLine.years[i].dataset.year=o,this._yearsLine.years[i].className=o===s?"jsCalendar-current":""},e.detectElementPositionInfo=function(t){var e,s,i=0,o=0,a=!1,n=!1;for(e=window.getComputedStyle(t);t;){if(i+=t.offsetLeft-t.scrollLeft,o+=t.offsetTop-t.scrollTop,"fixed"==e.position){a="fixed",o+=window.scrollY,i+=window.scrollX;break}"absolute"!=e.position&&"fixed"!=e.position||(s=parseInt(e.zIndex,10),n=isNaN(s)?0:s),t=t.offsetParent,t&&(e=window.getComputedStyle(t),i+=parseInt(e.borderLeftWidth,10),o+=+parseInt(e.borderTopWidth,10))}for(;t;)e=window.getComputedStyle(t),"fixed"!=e.position&&"absolute"!=e.position||(s=parseInt(e.zIndex,10),n=isNaN(s)?0:s),t=t.offsetParent;return{top:o,left:i,zIndex:n,position:a}},e.autoFind=function(){for(var t=document.getElementsByTagName("input"),s=[],i=0;i<t.length;i++)"text"===t[i].type&&t[i].dataset.hasOwnProperty("datepicker")&&"true"!==t[i].getAttribute("jsCalendar-datepicker-loaded")&&s.push(t[i]);for(i=0;i<s.length;i++)s[i].setAttribute("jsCalendar-datepicker-loaded","true"),new e(s[i])},t.datepicker=function(){var t=new e;return t._construct(arguments),t},window.addEventListener("load",function(){e.autoFind()},!1),t.ext("DatePicker",e)})(window.jsCalendar);